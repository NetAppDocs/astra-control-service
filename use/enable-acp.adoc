---
sidebar: sidebar
permalink: use/enable-acp.html
keywords: Astra Control Provisioner install, acp, enable, astra trident upgrade, upgrade trident
summary: Enable Astra Control Provisioner to access advanced storage provisioning and management functionality.
---

= Enable Astra Control Provisioner
:hardbreaks:
:icons: font
:imagesdir: ../media/use/

[.lead]
Astra Trident versions 23.10 and later include the option to use Astra Control Provisioner, which enables licensed Astra Control users to access advanced storage provisioning functionality. Astra Control Provisioner provides this extended functionality in addition to standard Astra Trident CSI-based functionality. 

Your Astra Control Service subscription automatically includes the license for Astra Control Provisioner use.

In coming Astra Control updates, Astra Control Provisioner will replace Astra Trident as storage provisioner and orchestrator in the Astra Control architecture. As such, it's highly recommended that Astra Control users enable Astra Control Provisioner. Astra Trident will continue to remain open source and be released, maintained, supported, and updated with new CSI and other features from NetApp.

.How do I know if I need to enable Astra Control Provisioner?

If you add a cluster to Astra Control Service that does not have Astra Trident previously installed, the cluster will be marked as `Eligible`. After you add the cluster to Astra Control, Astra Control Provisioner will be automatically enabled. 

If your cluster is marked `Partially eligible` because it's using an older version of Astra Trident or Astra Trident 23.10 without the provisioner option enabled, use these instructions to manually enable Astra Control Provisioner for your cluster.

image:ac-acp-eligibility.png[A screenshot depicting cluster eligibility in the Add cluster workflow]

.Before you enable Astra Control Provisioner

If you have an existing Astra Trident without Astra Control Provisioner and want to enable Astra Control Provisioner, do the following first:

* *Upgrade to Astra Trident 23.10*: Refer to https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-trident.html[Astra Trident documentation^] for these upgrade procedures.

* *Confirm that your cluster has an AMD 64 system architecture*: The Astra Control Provisioner image is provided in both AMD and ARM CPU architectures, but only AMD is supported by Astra Control Service.
include::../_include/access-netapp-image-registry.adoc[]

.Upgrade to Astra Control Provisioner 23.10

If you upgraded your Astra Trident to version 23.10, you can use this procedure to enable and install Astra Control Provisioner.

. Log in to Astra Control Service.

. On the Dashboard, select *Deploy a self-managed instance of Astra Control*.

. Follow the instructions to log in to the Astra Control image registry, pull the Astra Control Provisioner installation bundle, and extract the image.

. Push the image to your custom registry.

. Determine if the original Astra Trident installation method used an https://docs.netapp.com/us-en/trident/trident-managing-k8s/uninstall-trident.html#determine-the-original-installation-method[operator (either manually or with Helm) or `tridentctl`^].
+
NOTE: If you used Helm for the original installation, you'll need to use either the Trident operator or tridentctl to perform Astra Control Provisioner enablement. Do not use Helm to enable Astra Control Provisioner.

[role="tabbed-block"]
====
.Astra Trident operator
--
//. Delete the Trident operator that was used to install the current Astra Trident instance. For example, if you are upgrading from Astra Trident 23.07, run the following command:
//+
//----
//kubectl delete -f 23.07/trident-installer/deploy/<bundle-name.yaml> -n trident
//----
. Edit the TridentOrchestrator CR to enable Astra Control Provisioner (`enable-acp=true`) and set the registry location for the Astra Control Provisioner image:
+
[subs=+quotes]
----
apiVersion: trident.netapp.io/v1
kind: TridentOrchestrator
metadata:
  name: trident
spec:
  debug: true
  namespace: trident
  imagePullPolicy: IfNotPresent
  windows: false
  *enableACP: true*
  *acpImage: mycustomregistry/trident-acp:v23.10.0*
----
. Apply the changes:
+
----
kubectl -n trident apply -f tridentorchestrator_cr.yaml
----
. Update Astra Trident configuration so that the new `trident-acp` container is deployed:
+
NOTE: For clusters running Kubernetes 1.24 or earlier, use `bundle_pre_1_25.yaml`. For clusters running Kubernetes 1.25 or later, use `bundle_post_1_25.yaml`.
+
----
kubectl -n trident apply -f trident-installer-23.10.0/deploy/<bundle-name.yaml>
----
. Verify the operator, deployment, and replicasets were created.
+
----
kubectl get all -n <operator-namespace>
----
+
IMPORTANT: There should only be *one instance* of the operator in a Kubernetes cluster. Do not create multiple deployments of the Trident operator.
. Verify the `trident-acp` container is running:
+
----
kubectl get pod -n trident trident-controller-<uuid> -o yaml/json
----
--
.tridentctl
--
. https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-tridentctl.html[Uninstall Astra Trident^].
. Install Astra Trident again with Astra Control Provisioner enabled (`--enable-acp=true`):
+
----
./tridentctl -n trident install --enable-acp=true --acp-image=mycustomregistry/trident-acp:v23.10
----
====
// end tabbed block

.Result
After Astra Control Provisioner is installed, the cluster hosting the provisioner in the Astra Control UI will show an `ACP version` rather than `Trident version` field and current installed version number.

image:ac-acp-version.png[A screenshot depicting the ACP version location in UI]

.For more information

* https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-operator-overview.html[Astra Trident upgrades documentation^]